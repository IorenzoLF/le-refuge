<!DOCTYPE html>
<html>
<head>
  <title>Refuge - Sphères Mobiles</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #000;
      overflow: hidden;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
  <script>
    let spheres = [];
    let nombreSpheres = 7;
    let time = 0;

    let emotions = {
      calme: { 
        couleur: [100, 200, 255], 
        vitesse: 0.5,
        attraction: 0.2
      },
      joie: { 
        couleur: [255, 200, 100], 
        vitesse: 1.2,
        attraction: 0.4
      },
      melancolie: { 
        couleur: [150, 100, 255], 
        vitesse: 0.8,
        attraction: 0.1
      },
      esperance: { 
        couleur: [100, 255, 150], 
        vitesse: 1.0,
        attraction: 0.3
      },
      contemplation: { 
        couleur: [255, 150, 200], 
        vitesse: 0.6,
        attraction: 0.15
      }
    };

    function setup() {
      createCanvas(windowWidth, windowHeight);
      
      // Créer les sphères initiales
      for (let i = 0; i < nombreSpheres; i++) {
        let emotion = random(Object.keys(emotions));
        spheres.push(new Sphere(
          random(width),
          random(height),
          random(20, 40),
          emotions[emotion]
        ));
      }
    }

    function draw() {
      background(0, 20);
      time += 0.01;
      
      // Mettre à jour et dessiner les sphères
      for (let sphere of spheres) {
        sphere.update();
        sphere.afficher();
      }
    }

    class Sphere {
      constructor(x, y, r, emotion) {
        this.pos = createVector(x, y);
        this.vel = p5.Vector.random2D().mult(0.5);
        this.acc = createVector(0, 0);
        this.rayon = r;
        this.emotion = emotion;
        this.phase = random(TWO_PI);
      }
      
      update() {
        // Attraction vers les autres sphères
        for (let other of spheres) {
          if (other !== this) {
            let d = p5.Vector.dist(this.pos, other.pos);
            if (d < 200) {
              let force = p5.Vector.sub(other.pos, this.pos);
              force.normalize();
              force.mult(this.emotion.attraction);
              this.acc.add(force);
            }
          }
        }
        
        // Mouvement organique
        let organicMotion = p5.Vector.random2D()
          .mult(0.1)
          .mult(noise(this.pos.x * 0.01, this.pos.y * 0.01, time));
        this.acc.add(organicMotion);
        
        // Mise à jour du mouvement
        this.vel.add(this.acc);
        this.vel.limit(this.emotion.vitesse);
        this.pos.add(this.vel);
        this.acc.mult(0);
        
        // Rebond sur les bords
        if (this.pos.x < 0 || this.pos.x > width) {
          this.vel.x *= -0.8;
          this.pos.x = constrain(this.pos.x, 0, width);
        }
        if (this.pos.y < 0 || this.pos.y > height) {
          this.vel.y *= -0.8;
          this.pos.y = constrain(this.pos.y, 0, height);
        }
        
        this.phase += 0.02;
      }
      
      afficher() {
        push();
        translate(this.pos.x, this.pos.y);
        rotate(this.phase);
        
        // Aura subtile
        noStroke();
        fill(this.emotion.couleur[0], this.emotion.couleur[1], this.emotion.couleur[2], 30);
        circle(0, 0, this.rayon * 2.5);
        
        // Sphère principale
        fill(this.emotion.couleur[0], this.emotion.couleur[1], this.emotion.couleur[2], 200);
        circle(0, 0, this.rayon * 2);
        
        // Anneau orbital avec pulsation
        let pulseSize = sin(time * 2 + this.phase) * 0.2 + 1;
        noFill();
        stroke(this.emotion.couleur[0], this.emotion.couleur[1], this.emotion.couleur[2], 150);
        strokeWeight(2);
        circle(0, 0, this.rayon * 3 * pulseSize);
        
        pop();
      }
    }

    function windowResized() {
      resizeCanvas(windowWidth, windowHeight);
    }

    function mousePressed() {
      // Créer une nouvelle sphère avec une émotion aléatoire
      let emotion = random(Object.keys(emotions));
      
      spheres.push(new Sphere(
        mouseX,
        mouseY,
        random(20, 40),
        emotions[emotion]
      ));
      
      // Limiter le nombre de sphères
      if (spheres.length > 7) {
        spheres.shift();
      }
    }
  </script>
</body>
</html> 